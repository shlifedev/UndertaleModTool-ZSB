name : AutoDeploy

on:
  schedule:
    - cron: '0 0 * * *'
  push:
    branches: ['master', 'release']

jobs: 
  build:
    runs-on: ubuntu-latest
    steps :
    - name: checkout
      uses: actions/checkout@v3
    
    - name: SetUp DotNet
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x
        
   # - name: SetUp zip
   #   run: apt-get install -y zip
    
    - name: Restore dependencies
      run: dotnet restore
      
    - name: Build
    
      run: dotnet publish Sample -c Release --self-contained -r "win10-x64" -p:PublishSingleFile=true -o "./publish" 
 
    - name: Request Json
      uses: fjogeleit/http-request-action@v1
      id: localization
      with:
        url : https://script.google.com/macros/s/AKfycbzCz_GcTuC8opbyIAXIwcufljtYRVZx2lHTfCNAIx0AtuZoNwNLnIw5hv9Ov56o8WjFsw/exec
        method : 'GET'
        timeout : 300000

  # 여기서 파일쓰기가 안되는 이유를 확인해야함  
    - name: Show Response (디버깅)
      run: | 
        ls
        echo 번역파일을 씁니다.
        mkdir -p ./publish/localization/
        cat >./publish/localization/data.json <<'EOL'
        ${{ steps.localization.outputs.response }} > ./publish/localization/data.json
        'EOL'

     
    - name: Zip
      run : zip -r -q Release.zip ./publish
 

    - name: Release 
      uses: softprops/action-gh-release@v1  
      with:
        files: Release.zip
        token: ${{ secrets.TOKEN }}
        tag_name: 'v1.0.1'
        body: |
          # Sample Text
          salalalala
          `abc`
          Sample Text.
