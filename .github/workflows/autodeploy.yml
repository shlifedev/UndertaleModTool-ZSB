name : auto

on:
  schedule:
    - cron: '0 0 * * *'
  push:
    branches: ['master']

jobs: 
  build:
    runs-on: windows-latest
    steps :
    - name: checkout
      uses: actions/checkout@v3
    
    - name: SetUp DotNet
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x
        
    - name: SetUp zip
      run: apt-get install -y zip
    
    - name: Restore dependencies
      run: dotnet restore
      
    - name: Build
    
      run: dotnet publish Sample -c Release --self-contained -r "win10-x64" -p:PublishSingleFile=true -o "./publish" 
 
    - name: Request Json
      uses: fjogeleit/http-request-action@v1
      id: localization
      with:
        url : https://script.google.com/macros/s/AKfycbzCz_GcTuC8opbyIAXIwcufljtYRVZx2lHTfCNAIx0AtuZoNwNLnIw5hv9Ov56o8WjFsw/exec
        method : 'GET'
    
    - name: Show Response (디버깅)
      run: |
        echo ${{ steps.localization.outputs.response }} 
        ls
        echo ${{ steps.localization.outputs.response }} > ./publish/localization/data.json
     
    - name: Zip
      run : zip -r -q Release.zip ./publish
    
    - name: Release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: Release.zip
        token : ${{secrets.CUSTOM_GITHUB_TOKEN}}
